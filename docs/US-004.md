## US-004: Pronunciation support (Dev-ready)

### Story

As a user,
I want to hear the pronunciation of a word,
so that I can learn how it sounds while typing it.

### Scope

* Web-only MVP.
* Pronunciation uses **Web Speech API** (`window.speechSynthesis`) only.
* No external TTS services, no backend.
* Pronunciation must not block typing and must not break the session if unavailable.

### UX / UI Specification

#### On Training screen

* Add a small **speaker button** рядом со словом (или рядом с переводом), не мешающий фокусу ввода.
* Add setting/toggle:

  * **Auto-speak on new word** (default: OFF for MVP, to reduce distraction).
* Provide a keyboard shortcut to speak current word:

  * Must not conflict with typing letters.
  * Recommendation: `Alt+S` (Windows/Linux) and `Option+S` (macOS) or `Ctrl+Alt+S`.
  * Shortcut should work regardless of input focus.

#### Behavior

* Manual speak (button or shortcut) speaks the **current target word**.
* If auto-speak enabled, app speaks the word when:

  * a session starts (first word) and
  * after each word transition.

### Functional requirements

#### TTS Provider contract

Introduce a domain provider:

```ts
interface PronunciationProvider {
  isAvailable(): boolean;
  speak(text: string): void;
  cancel(): void;
  setEnabled(enabled: boolean): void;          // optional if you keep settings outside
  setAutoSpeak(enabled: boolean): void;        // optional if you keep settings outside
  setVoicePreference?(voiceId: string): void;  // out of scope for MVP UI
}
```

MVP can be simpler; the key is: **UI does not call Web Speech API directly**.

#### Selection of language / voice

* Language should default to **English** (en-US or en-GB).
* For MVP, select the first available English voice.
* No user-facing voice selector required for MVP.

#### Error handling / resilience

* If `speechSynthesis` is unavailable or throws:

  * do nothing (silent fail) OR show a tiny non-blocking indicator (e.g., disabled icon). No popups.
* If user triggers speak repeatedly:

  * cancel previous utterance and speak the latest (recommended for responsiveness).

### Acceptance Criteria

* Training screen has a speak control (button) that pronounces the current word.
* Auto-speak (toggle) pronounces new words when enabled.
* Pronunciation does not interfere with typing (input remains focused; no lag).
* If pronunciation is unavailable, the app continues without errors; speak control is disabled or no-ops gracefully.
* Setting for auto-speak persists locally and applies on reload.
* Shortcut triggers speak without breaking typing input.

### Out of scope (explicit)

* External TTS services (Google/DeepL/AWS Polly).
* Offline voice downloads / OS-level voice management.
* Phonetics/IPA display.
* Pronouncing translations (only English word).

### Definition of Done

* `WebSpeechPronunciationProvider` implemented in `src/domain/`.
* Minimal unit tests for provider logic that can be tested (e.g., availability detection, safe no-throw wrappers).
  (Note: SpeechSynthesis itself is not reliably testable in jsdom; tests should mock `window.speechSynthesis`.)
* One UI test verifies:

  * speaker button exists,
  * when TTS unavailable, button is disabled (or clicking does not crash).

### Technical Notes (MVP)

* Ensure `speechSynthesis.cancel()` is called before speaking a new word to prevent queue buildup.
* If voices are loaded asynchronously (`voiceschanged`), provider should handle it lazily:

  * attempt to choose an English voice on first speak,
  * fall back to default utterance voice if not found.
* Do not call `speak()` during render; only in effects / event handlers.

---

## Разбиение на задачи (в TODO под US-004)

1. **Domain**: `pronunciationProvider.ts` + `webSpeechProvider.ts`
2. **Settings**: `autoSpeak` toggle persisted (как у language settings)
3. **UI**: speaker button рядом со словом + shortcut handler
4. **Wiring**: on word change → if autoSpeak → speak
5. **Tests**:

  * provider: mock speechSynthesis, assert no-throw and cancel-before-speak
  * UI: button disabled when unavailable