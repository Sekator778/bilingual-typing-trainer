# US-007: Session Presets (time / word count) — Work Breakdown Structure

## Цель истории

Дать пользователю “упакованные” тренировки (например, **25 слов** или **3 минуты**), чтобы:

* проще начинать (“сделаю короткую сессию”),
* результаты были сравнимыми,
* статистика/история были более осмысленными.

---

## P0 — Решения (зафиксировать в DECISIONS.md)

1. **Тип пресета**

* `byWords`: N слов (25/50/100)
* `byTime`: N минут (1/3/5/10)

2. **Когда считается “завершено”**

* `byWords`: завершено, когда `wordsCompleted >= N`
* `byTime`: завершено, когда `elapsedMs >= durationMs`

3. **Что делать при завершении**

* MVP: автоматически “finish session” → сохранить запись в history → показать краткий summary (экран) или сразу отправить в History.
* Рекомендация: показать Summary screen (минимальный).

4. **Поведение при досрочном выходе**

* MVP: если пользователь уходит со страницы — можно сохранить как `interrupted=true` (опционально).
* Если не хотите усложнять: сохранить как обычную сессию с меньшей длительностью и флагом `completed=false`.

---

## P1 — Data model (domain)

5. Добавить типы пресетов:

```ts
export type Preset =
  | { kind: "infinite" }
  | { kind: "byWords"; targetWords: number }
  | { kind: "byTime"; durationMs: number };

export type SessionOutcome = "completed" | "interrupted";
```

6. Расширить `SessionRecord` (который вы сохраняете в history):

* `preset: Preset`
* `outcome: SessionOutcome`
* `level?: Level`
* `mode?: TrainingMode` (normal/mistakes)

Цель: History становится объяснимой (“B1, Mistakes, 25 words, completed”).

---

## P2 — Settings: хранение выбора пресета

7. Создать `src/domain/presetSettings.ts`

* key: `typing.preset.v1`
* `getPreset(): Preset`
* `setPreset(p: Preset): void`
* default: `{ kind: "infinite" }` (или byWords=25 — на ваш вкус)

---

## P3 — UI: SetupScreen — выбор пресета

8. Добавить в SetupScreen блок “Session length”:

* варианты (radio / segmented):

    * Infinite
    * 25 words
    * 50 words
    * 100 words
    * 3 minutes
    * 5 minutes
    * 10 minutes

Best practice:

* сделать это компактно (segmented control / small radio list).
* значение видно перед Start.

9. При нажатии Start передать preset в Training (через state/props или через settings).

---

## P4 — TrainingScreen: контроль завершения

10. Подключить preset к TrainingScreen:

* при старте сессии:

    * сброс counters
    * запомнить `sessionStartedAt`
    * если `byTime`: стартовать таймер/interval (например, tick каждые 250–500ms) только для проверки конца, не для рендера каждого миллисекунда

11. Реализовать условие завершения:

* `byWords`:

    * после commit слова (`onWordCompleted`) проверить `wordsCompleted >= targetWords`
* `byTime`:

    * на tick проверять `Date.now() - startedAt >= durationMs`

12. Завершение (finish flow):

* вызвать `StatsModule.finish(outcome="completed")` (или аналог)
* сохранить `SessionRecord` в sessionStore (у вас уже есть)
* перенаправить на Summary или History

---

## P5 — Summary screen (рекомендую как минимальный отдельный экран)

13. Добавить `SummaryScreen.tsx`
    Показывать:

* WPM
* Accuracy
* Words completed
* Duration
* Level / Mode / Preset
  Кнопки:
* “Start again”
* “History”

Это резко повышает UX без нагрузки на TrainingScreen.

---

## P6 — History: улучшить отображение пресета

14. В HistoryScreen добавить вывод:

* preset label (например “25 words”, “5 min”, “∞”)
* outcome (“completed” / “interrupted”) — можно маленькой подписью

---

## P7 — Tests (обязательные)

15. Unit tests: preset logic

* byWords: when wordsCompleted reaches target → session ends
* byTime: when time passes duration → session ends
  (Можно тестировать через mock Date.now + fake timers.)

16. UI tests:

* Setup выбирает “25 words” → старт → после 25 correct commits должен произойти redirect/summary.
* byTime можно тестировать fake timers: +3min → завершение.

17. Storage tests:

* SessionRecord включает preset и outcome.

---

## P8 — Docs

18. `docs/DECISIONS.md`:

* пресеты и критерии завершения
* как сохраняем outcome

19. `docs/TODO.md`:

* checklist под US-007

---

# Deliverables (PR)

* `presetSettings.ts`
* обновления SetupScreen + TrainingScreen
* (желательно) `SummaryScreen`
* History UI обновлён
* тесты зелёные

---

# Минимальный MVP вариант (если хотите очень быстро)

Если хотите “сделать за вечер”:

* реализовать только `byWords` (25/50/100)
* без byTime
* summary можно отложить и сразу уходить в History

Но best practice — сделать оба типа, они хорошо тестируются и не сложны.
